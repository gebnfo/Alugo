<!DOCTYPE html>
<html lang="pt-br">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Meus Produtos - Alugo</title>

  <!-- Bootstrap core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="manifest" href="manifest.json">
  <!-- Suporte para IOS-->
  <link rel="apple-touch-icon" href="icons/icon-96x96.png">
  <meta name="apple-mobile-web-app-status-bar" content="#083354">
  <link href="css/corpo.css" rel="stylesheet">

<body>

  <nav class="navbar fixed-top navbar-expand-lg bg-dark fixed-top box-shadow py-2">
    <div class="container nav-alugo">
      <a class="navbar-brand" href="home.html">Alugo</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
        data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="planos.html">
              <img src="img/icone-prime.ico" style="width: 30px;" alt="icone prime">
              Seja Prime</a>
          </li>
          <li class="nav-item">
            <a style="color: #836FFF;" class="nav-link" href="meus_produtos.html">
              <img src="img/icone-meus-anuncios.png" style="width: 30px;" alt="icone meus anuncios">
              Meus Anúncios</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-toggle="dropdown"
              href="perfil_usuario.html">
              <img src="img/icone-perfil.png" style="width: 30px;" alt="icone perfil">
              Perfil</a>
            <div class="dropdown-menu" style="border-radius: 30px;" aria-labelledby="navbarDropdown">
              <div class="arredondar-linha">
                <a style="color: rgb(74, 74, 74);" class="dropdown-item" href="perfil_usuario.html">Meu Perfil
                  <img class="ml-1" src="img/icone-perfil.ico" style="width: 30px;" alt="icone perfil"></a>
              </div>
              <div class="arredondar-linha">
                <a style="color: rgb(74, 74, 74);" class="dropdown-item" href="meus_produtos.html">Meus Anúncios
                  <img class="ml-1" src="img/icone-meus-anuncios.png" style="width: 30px;" alt="icone meus anuncios"></a>
              </div>
              <div class="arredondar-linha">
                <a style="color: rgb(74, 74, 74);" class="dropdown-item" href="meus_chats_usuario.html">
                  Chat
                  <img class="ml-2" src="img/icone-chat.png" style="width: 30px;" alt="icone chat"></a>
              </div>
              <div class="arredondar-linha">
                <a style="color: rgb(74, 74, 74);" class="dropdown-item" href="ajuda_usuario.html">
                  Ajuda
                  <img src="img/icone-ajuda-2.ico" class="ml-1" style="width: 30px;" alt="icone ajuda"></a>
              </div>
              <a style="color: rgb(74, 74, 74);" class="dropdown-item" href="Index.html">Sair
                <img src="img/icone-sair.png" style="width: 30px;" alt="icone sair"></a>
            </div>
          </li>
          <li class="nav-item tamanho-hover">
            <a id="anunciar" class="btn text-white ml-md-2 px-3" style="background-color: orange; border-radius: 30px;"
              href="inserir_produto.html">Anunciar</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="wrapper">

    <section class="container text-center mb-5 box-shadow">
      <div>
        <h1 class="display-4 text-primary mb-5">Meus Anúncios</h1>
      </div>
      <div class="row">
        <div class="col" id="produtos">

          <div class="produto py-2 col-12">

            <div class="p-3" style="border: 2px solid #ccc; border-radius: 20px;">

              <div id="publicados" class="collapse show" role="tabpanel" data-parent="#produtos">

              </div>

          </div>



        </div>


      </div>

      <!-- aqui abaixo -->


      <!-- aquibaixo não apagar-->
    </section>
    <div class="push"></div>
  </div>
  <footer class="bg-dark text-white p-5">

    <div class="row text-center justify-content-between text-white">

      <div class="col-md-5 d-flex">
        <img class="mr-1 rounded" src="icons/icon-192x192.png" style="width: 70px; height: 50px;
        min-width: 70px;" alt="icone">
        <p>© Copyright 2020 - Alugo - Todos os direitos reservados CNPJ 14.380.200/0001-21 / Avenida dos Autonomistas,
          nº 1496, Casa Caiada, Olinda/PE - CEP 06.020-902</p>
      </div>

      <div class="col-md-5 align-self-center d-flex">
        <a class="" href="termos_usuario.html" style="color: white;">Termos e condições de uso</a>
        <a class="ml-5" href="ajuda_usuario.html" style="color: white;">Perguntas Frequentes</a>
      </div>

    </div>
    </div>
  </footer>

  <div class="modal fade" id="modalAlterar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Alterar anúncio</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form class="col-lg-9">
            <div class="ml-3 mr-3 form-group">
              Titulo:
              <input type="text" class="form-control" required id="inputNome" placeholder="Título*">
            </div>
            
            <div class="ml-3 mr-3 form-group">
              Preço:
              <input type="text" id="inputPreco" required class="form-control" placeholder="Preço*">
            </div>

            
            <div class="ml-3 mr-3 form-group">
              Url imagem:
              <input type="text" id="inputImagem" required class="form-control" placeholder="url imagem*">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
          <button id="botaoAlterarModal" type="button" class="btn btn-primary">Salvar mudanças</button>
        </div>
      </div>
    </div>
  </div>


  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js">  </script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script>
    var server = "http://localhost:3001/products"
    
  $.ajax ({
    url: server,
    type: 'GET',
    dataType : 'json',
    success : function (produtos){
      produtos.forEach(produto => preencherProdutos(produto.id ,produto.name, produto.price, produto.path));
    }, 
    error: function(erro){
      alert("Servidor Indisponivel")
    }
  })  

    function preencherProdutos (id, descricaoProduto, precoProduto, imagemProduto) {

    var divAnuncio = document.createElement("div")
    divAnuncio.id = "divAnuncio" + id
    divAnuncio.className = "col-md rounded pb-3 ml-3 mr-3 pt-2 mt-3 mt-md-0"
    divAnuncio.style = "border:1px solid #ccc"

    var imagem = document.createElement("img")
    imagem.className = "rounded w-75"
    imagem.src = imagemProduto
    imagem.style = "width: 640px; height: 480;"
    
    var divDescricao = document.createElement("div")
    divDescricao.className = "mt-3 mb-2"
    var descricao = document.createElement("span") 
    descricao.innerText = descricaoProduto
    divDescricao.appendChild(descricao)

    var divPreco = document.createElement("div")
    divPreco.className = "mb-2"
    var preco = document.createElement("span")
    preco.style = "font-weight: bold;"
    preco.innerText = "R$: " + precoProduto
    divPreco.appendChild(preco)

    var divBotoes = document.createElement("div")
    var botaoAlterar = document.createElement("button")
    botaoAlterar.setAttribute('type','button')
    botaoAlterar.setAttribute('data-toggle','modal')
    botaoAlterar.setAttribute('data-target','#modalAlterar')
    botaoAlterar.setAttribute('onclick','preencherAlterar(' + id + ' , "' +  descricaoProduto + '" , "' + precoProduto + '" , "' +  imagemProduto +'" )')

    botaoAlterar.className = "btn btn-primary btn-block arredondar"
    botaoAlterar.innerText = "Alterar"

    var botaoExcluir = document.createElement("button")
    botaoExcluir.className = "btn btn-primary btn-block arredondar"
    botaoExcluir.innerText = "Excluir"
    botaoExcluir.setAttribute('type','button')
    botaoExcluir.setAttribute('onclick','excluir(' + id + ')')
    divBotoes.appendChild(botaoAlterar)
    divBotoes.appendChild(botaoExcluir)
    divAnuncio.appendChild(imagem)
    divAnuncio.appendChild(divDescricao)
    divAnuncio.appendChild(divPreco)
    divAnuncio.appendChild(divBotoes)

    var anunciados = document.getElementById("publicados")
    anunciados.appendChild(divAnuncio)   
      
  }

  function excluir (id){
    $.ajax({
    url: server + "/" + id,
    method: 'DELETE',
    contentType: 'application/json',
    success: function(result) {
      var node = document.getElementById("divAnuncio" + id);
      if (node.parentNode) 
      node.parentNode.removeChild(node);
        alert("Excluido com sucesso!")
    },
    error: function(request,msg,error) {
        alert("erro!")
    }
  });

  }

  function alterar (id){
    var server = "http://localhost:3001/products/" + id

    var nome = document.getElementById("inputNome").value
    var preco = document.getElementById("inputPreco").value
    var url = document.getElementById("inputImagem").value
    var sendInfo = {
           name: nome,
           price: preco,
           path: url
       };

       $.ajax({
           type: "PUT",
           url: server,
           dataType: "json",
           success: function (msg) {
               alert("Produto Alterado com sucesso!")
           },
           error (){
              alert("Servidor não conectado!")
           },

           data: sendInfo
       });
  }

  function preencherAlterar (id, nome, preco, url){

    document.getElementById("inputNome").value = nome
    document.getElementById("inputPreco").value = preco
    document.getElementById("inputImagem").value = url
    document.getElementById("botaoAlterarModal").setAttribute('onclick','alterar(' + id + ')')
}
  </script>
</body>

</html>